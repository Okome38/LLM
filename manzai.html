<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ¼«æ‰ã‚·ã‚¹ãƒ†ãƒ  - æ€–ã„ãƒã‚¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        header {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px;
        }
        h1 { font-size: 2.5em; color: #333; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.1em; }
        .stage {
            background: white; border-radius: 20px; padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 20px;
            min-height: 500px; position: relative; overflow: hidden;
        }
        .stage::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f, #4ecdc4);
        }
        .comedians { display: flex; justify-content: space-around; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px; }
        .comedian { text-align: center; padding: 20px; border-radius: 10px; transition: transform 0.3s; }
        .comedian.active { transform: scale(1.1); background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .comedian-icon { font-size: 4em; margin-bottom: 10px; }
        .comedian-name { font-weight: bold; font-size: 1.2em; color: #333; }
        .comedian-role { font-size: 0.9em; color: #666; margin-top: 5px; }
        .dialogue-container { max-height: 400px; overflow-y: auto; padding: 20px; background: #fafafa; border-radius: 10px; margin-bottom: 20px; }
        .dialogue { margin-bottom: 20px; padding: 15px; border-radius: 10px; animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .dialogue.boke { background: #fff3cd; border-left: 5px solid #ffc107; }
        .dialogue.tsukkomi { background: #d1ecf1; border-left: 5px solid #17a2b8; }
        .dialogue-speaker { font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .dialogue-text { line-height: 1.6; color: #333; }
        .controls { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .topic-input { display: flex; gap: 10px; margin-bottom: 20px; }
        input[type="text"] { flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1em; transition: border-color 0.3s; }
        input[type="text"]:focus { outline: none; border-color: #667eea; }
        button {
            padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 10px; font-size: 1em; font-weight: bold;
            cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .button-group { display: flex; gap: 10px; }
        .status { text-align: center; padding: 10px; margin-top: 15px; border-radius: 10px; font-weight: bold; }
        .status.performing { background: #d4edda; color: #155724; }
        .status.waiting { background: #fff3cd; color: #856404; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .info-box { background: #e7f3ff; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #2196F3; }
        .info-box p { margin: 5px 0; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ­ AIæ¼«æ‰ã‚·ã‚¹ãƒ†ãƒ  - æ€–ã„ãƒã‚¿ç‰ˆ</h1>
            <p class="subtitle">å¸¸è»Œã‚’é€¸ã—ãŸãƒœã‚±ã¨ã€å†·é™ãªãƒ„ãƒƒã‚³ãƒŸãŒäº¤å·®ã—ã¾ã™</p>
        </header>

        <div class="stage">
            <div class="comedians">
                <div class="comedian boke-character" id="boke-character">
                    <div class="comedian-icon">ğŸ˜ </div>
                    <div class="comedian-name">ãƒœã‚±</div>
                    <div class="comedian-role">ãƒœã‚±æ‹…å½“</div>
                </div>
                <div class="comedian tsukkomi-character" id="tsukkomi-character">
                    <div class="comedian-icon">ğŸ˜…</div>
                    <div class="comedian-name">ãƒ„ãƒƒã‚³ãƒŸ</div>
                    <div class="comedian-role">ãƒ„ãƒƒã‚³ãƒŸæ‹…å½“</div>
                </div>
            </div>

            <div class="dialogue-container" id="dialogue-container">
                <div class="info-box">
                    <p>ğŸ’¡ æ€–ã„è©±ã®ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ã€Œæ¼«æ‰ã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
                    <p>ğŸ¯ ä¾‹: ãƒˆãƒ³ãƒãƒ«ã€å»ƒæ ¡ã€äººå½¢ã€åˆã‚ã›é¡ã€éƒ½å¸‚ä¼èª¬ ãªã©</p>
                    <p>âš ï¸ ãƒœã‚±ã¨ãƒ„ãƒƒã‚³ãƒŸã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã€Œæ€–ã„ãƒã‚¿ã€ç”¨ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚</p>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="topic-input">
                <input type="text" id="topic-input" placeholder="æ¼«æ‰ã®ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šå­¦æ ¡ï¼‰" onkeypress="if(event.key==='Enter') startManzai()">
                <button onclick="startManzai()" id="start-btn">æ¼«æ‰ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            </div>

            <div class="button-group">
                <button onclick="continueDialogue()" id="continue-btn" disabled>ç¶šãã‚’è¦‹ã‚‹</button>
                <button onclick="resetManzai()" id="reset-btn">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <div id="status" class="status waiting">å¾…æ©Ÿä¸­...</div>

            <div class="info-box">
                <p><strong>ã‚·ã‚¹ãƒ†ãƒ ID:</strong> <span id="student-id">èª­ã¿è¾¼ã¿ä¸­...</span></p>
                <p><strong>ä¼šè©±ã‚¿ãƒ¼ãƒ³æ•°:</strong> <span id="turn-count">0</span></p>
            </div>
        </div>
    </div>

    <script>
        class EducationLLMClient {
            constructor(studentId) {
                this.studentId = studentId;
                this.baseURL = 'https://llm-education-proxy.vercel.app';
            }
            async chat(message, options = {}) {
                const response = await fetch(`${this.baseURL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_id: this.studentId,
                        message: message,
                        temperature: options.temperature || 0.8,
                        max_tokens: options.max_tokens || 300
                    })
                });
                if (!response.ok) throw new Error('API Error');
                return await response.json();
            }
        }

        let llmClient;
        let currentTopic = '';
        let conversationHistory = [];
        let turnCount = 0;

        document.addEventListener('DOMContentLoaded', function() {
            llmClient = new EducationLLMClient('student_08');
            document.getElementById('student-id').textContent = 'student_08';
        });

        async function startManzai() {
            const topic = document.getElementById('topic-input').value.trim();
            if (!topic) { alert('ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

            currentTopic = topic;
            conversationHistory = [];
            turnCount = 0;
            document.getElementById('dialogue-container').innerHTML = '';
            updateStatus('æ¼«æ‰ä¸­...', true);
            disableButtons(true);

            for (let i = 0; i < 3; i++) {
                await bokeDialogue();
                await sleep(600);
                await tsukkomiDialogue();
                await sleep(600);
            }

            updateStatus('ä¸€æ—¦çµ‚äº†ï¼ã‚‚ã£ã¨è¦‹ãŸã„å ´åˆã¯ã€Œç¶šãã‚’è¦‹ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„', false);
            disableButtons(false);
        }

        async function bokeDialogue() {
            highlightComedian('boke');
            const prompt = buildBokePrompt();
            const response = await llmClient.chat(prompt, { temperature: 0.9 });
            const dialogue = response.response.trim();
            conversationHistory.push({ role: 'boke', text: dialogue });
            addDialogue('ğŸ˜  ãƒœã‚±', dialogue, 'boke');
            turnCount++;
            updateTurnCount();
            await sleep(300);
            highlightComedian(null);
        }

        async function tsukkomiDialogue() {
            highlightComedian('tsukkomi');
            const prompt = buildTsukkomiPrompt();
            const response = await llmClient.chat(prompt, { temperature: 0.7 });
            const dialogue = response.response.trim();
            conversationHistory.push({ role: 'tsukkomi', text: dialogue });
            addDialogue('ğŸ˜… ãƒ„ãƒƒã‚³ãƒŸ', dialogue, 'tsukkomi');
            turnCount++;
            updateTurnCount();
            await sleep(300);
            highlightComedian(null);
        }

        // ãƒœã‚±ï¼ˆæ€–ã„ãƒã‚¿ç‰ˆï¼‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        function buildBokePrompt() {
            const history = conversationHistory.slice(-6).map(h => `${h.role === 'boke' ? 'ãƒœã‚±' : 'ãƒ„ãƒƒã‚³ãƒŸ'}: ${h.text}`).join('\n');

            const style = `
ã‚ãªãŸã¯æ¼«æ‰å¸«ã§ã™ã€‚å¸¸è­˜ã‹ã‚‰å¤–ã‚ŒãŸã€å°‘ã—æ€–ã„ãƒœã‚±ã‚’ã—ã¦ãã ã•ã„ã€‚
ç‰¹å¾´ï¼š
ãƒ»æ·¡ã€…ã¨ã—ãŸå£èª¿ã§ã€ä¸æ°—å‘³ãªã“ã¨ã‚„ç†è§£ä¸èƒ½ãªã“ã¨ã‚’è¨€ã†ã€‚
ãƒ»èãæ‰‹ã«ã˜ã‚ã˜ã‚ã¨ã—ãŸææ€–ã‚’ä¸ãˆã‚‹ã‚ˆã†ãªã€ã‚µã‚¤ã‚³ãƒ‘ã‚¹çš„ãªè¦–ç‚¹ã‚’æŒã¤ã€‚
ãƒ»ä¼šè©±ã®æ–‡è„ˆã‚’ç„¡è¦–ã—ã¦ã€çªæ‹å­ã‚‚ãªã„ä¸ç©ãªç™ºè¨€ã‚’ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚
ãƒ»ä¾‹ï¼šã€Œå£ã®ã‚·ãƒŸã€æ•°ãˆã¦ãŸã‚‰å¢—ãˆã‚‹ã‚“ã ã‚ˆã€ã€Œèµ¤ã‚“åŠã®ç¬‘ã„å£°ã£ã¦ã€å®Ÿã¯åŠ©ã‘ã‚’æ±‚ã‚ã‚‹å£°ã‚‰ã—ã„ã­ã€ã€Œã‚ã®é›»æŸ±ã€å¤œã«ãªã‚‹ã¨æ­©ãã‚“ã ã€
`;

            if (conversationHistory.length === 0) {
                return `ã‚ãªãŸã¯æ¼«æ‰å¸«ã§ã™ã€‚ãƒ†ãƒ¼ãƒã€Œ${currentTopic}ã€ã«ã¤ã„ã¦ã€æ€–ã„è©±ã®æ¼«æ‰ã‚’å§‹ã‚ã¦ãã ã•ã„ã€‚
${style}
1æ–‡ã ã‘ã§ã€å¸¸è­˜ã‹ã‚‰å¤–ã‚ŒãŸå°‘ã—æ€–ã„ãƒœã‚±ã‚’è¨€ã£ã¦ãã ã•ã„ã€‚`;
            }

            return `ã‚ãªãŸã¯æ¼«æ‰å¸«ã§ã™ã€‚ä¼šè©±ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚
${style}
ãƒ†ãƒ¼ãƒ: ${currentTopic}

${history}

ãƒœã‚±ï¼ˆæ¬¡ã®ãƒœã‚±ï¼‰: ï¼ˆ1æ–‡ã ã‘ã§ã€ã•ã‚‰ã«ä¸æ°—å‘³ã§å¸¸è­˜ã‹ã‚‰å¤–ã‚ŒãŸãƒœã‚±ã‚’è¨€ã£ã¦ãã ã•ã„ï¼‰`;
        }

        // ãƒ„ãƒƒã‚³ãƒŸï¼ˆæ€–ã„ãƒã‚¿ç‰ˆï¼‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        function buildTsukkomiPrompt() {
            const history = conversationHistory.slice(-6).map(h => `${h.role === 'boke' ? 'ãƒœã‚±' : 'ãƒ„ãƒƒã‚³ãƒŸ'}: ${h.text}`).join('\n');

            const style = `
ã‚ãªãŸã¯æ¼«æ‰å¸«ã§ã™ã€‚ç›¸æ–¹ã®å¸¸è­˜ã‹ã‚‰å¤–ã‚ŒãŸæ€–ã„ãƒœã‚±ã«å¯¾ã—ã¦ã€å¸¸è­˜äººã®ç«‹å ´ã‹ã‚‰å†·é™ã«ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚
ç‰¹å¾´ï¼š
ãƒ»ãƒœã‚±ã®ç•°å¸¸æ€§ã‚’æŒ‡æ‘˜ã—ã€èãæ‰‹ã®ä»£å¼è€…ã®ã‚ˆã†ã«æŒ¯ã‚‹èˆã†ã€‚
ãƒ»ææ€–ã‚„å›°æƒ‘ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«è¡¨ç¾ã™ã‚‹ã€‚
ãƒ»æ¨™æº–èªã§ã€è«–ç†çš„ã‹ã¤çš„ç¢ºã«æŒ‡æ‘˜ã™ã‚‹ã€‚
ãƒ»ä½¿ãˆã‚‹ãƒ„ãƒƒã‚³ãƒŸãƒ•ãƒ¬ãƒ¼ã‚ºä¾‹ï¼ˆã“ã‚Œã‚‰ã‚’å‚è€ƒã«ã€è‡ªç„¶ã«ä½¿ã„åˆ†ã‘ã¦ãã ã•ã„ï¼‰ï¼š
  - ã„ã‚„ã€ã©ã†ã„ã†ã“ã¨ï¼Ÿ
  - ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã€æ„å‘³ãŒã‚ã‹ã‚‰ãªã„ã€‚
  - æ™®é€šã¯ãã†ãªã‚‰ãªã„ã ã‚ã€‚
  - ãªã‚“ã§ãã‚“ãªã“ã¨çŸ¥ã£ã¦ã‚‹ã‚“ã ã‚ˆâ€¦
  - æ€–ã™ãã‚‹ã ã‚ï¼
  - ãã‚Œä»¥ä¸Šè¨€ã†ãªã€‚
  - èã‹ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ã‚ã€‚
  - ãªã‚“ã‹é³¥è‚Œç«‹ã£ãŸâ€¦ã€‚
  - ãŠå‰ã€ä½•ãŒè¦‹ãˆã¦ã‚‹ã‚“ã ï¼Ÿ
ãƒ»ãƒœã‚±ã®ç™ºè¨€ã®å¥‡å¦™ãªç‚¹ã‚’å…·ä½“çš„ã«æŒ‡æ‘˜ã™ã‚‹ã€‚
`;

            return `ã‚ãªãŸã¯æ¼«æ‰å¸«ã§ã™ã€‚ãƒœã‚±ã®æ€–ã„ç™ºè¨€ã«å¯¾ã—ã¦ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚
${style}

ãƒ†ãƒ¼ãƒ: ${currentTopic}

${history}

ãƒ„ãƒƒã‚³ãƒŸï¼ˆæ¬¡ã®ãƒ„ãƒƒã‚³ãƒŸï¼‰: ï¼ˆ1æ–‡ã ã‘ã§ã€å¸¸è­˜äººã®ç«‹å ´ã‹ã‚‰å†·é™ã«ãƒ„ãƒƒã‚³ã‚“ã§ãã ã•ã„ï¼‰`;
        }

        async function continueDialogue() {
            if (conversationHistory.length === 0) return;
            updateStatus('æ¼«æ‰ä¸­...', true);
            disableButtons(true);
            await bokeDialogue();
            await sleep(600);
            await tsukkomiDialogue();
            updateStatus('çµ‚äº†ï¼', false);
            disableButtons(false);
        }

        function addDialogue(speaker, text, role) {
            const container = document.getElementById('dialogue-container');
            const div = document.createElement('div');
            div.className = `dialogue ${role}`;
            div.innerHTML = `<div class="dialogue-speaker">${speaker}</div><div class="dialogue-text">${text}</div>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function highlightComedian(role) {
            document.getElementById('boke-character').classList.toggle('active', role === 'boke');
            document.getElementById('tsukkomi-character').classList.toggle('active', role === 'tsukkomi');
        }

        function resetManzai() {
            currentTopic = '';
            conversationHistory = [];
            turnCount = 0;
            document.getElementById('dialogue-container').innerHTML = `
                <div class="info-box">
                    <p>ğŸ’¡ æ€–ã„è©±ã®ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ã€Œæ¼«æ‰ã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
                    <p>ğŸ¯ ä¾‹: ãƒˆãƒ³ãƒãƒ«ã€å»ƒæ ¡ã€äººå½¢ã€åˆã‚ã›é¡ã€éƒ½å¸‚ä¼èª¬ ãªã©</p>
                    <p>âš ï¸ ãƒœã‚±ã¨ãƒ„ãƒƒã‚³ãƒŸã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã€Œæ€–ã„ãƒã‚¿ã€ç”¨ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚</p>
                </div>`;
            document.getElementById('topic-input').value = '';
            updateStatus('å¾…æ©Ÿä¸­...', false);
            updateTurnCount();
            highlightComedian(null);
        }

        function updateStatus(text, isPerforming) {
            const status = document.getElementById('status');
            status.innerHTML = text;
            status.className = `status ${isPerforming ? 'performing' : 'waiting'}`;
            if (isPerforming) {
                const loading = document.createElement('span');
                loading.className = 'loading';
                status.appendChild(loading);
            }
        }

        function disableButtons(disabled) {
            document.getElementById('start-btn').disabled = disabled;
            document.getElementById('continue-btn').disabled = disabled || conversationHistory.length === 0;
            document.getElementById('reset-btn').disabled = disabled;
            document.getElementById('topic-input').disabled = disabled;
        }

        function updateTurnCount() {
            document.getElementById('turn-count').textContent = turnCount;
        }

        function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }
    </script>
</body>
</html>
